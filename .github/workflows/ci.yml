# =============================================
# GitHub Actions Workflow: CI Pipeline for Python (pytest)
# Maintainer: lakshmi1212/Example123
# Purpose: Automated testing of Python code using pytest on every push/PR to main
# Placement: .github/workflows/ci.yml
# =============================================

name: CI Pipeline

description: |
  Production-ready CI workflow for Python projects. Runs pytest tests on every push and pull request to main branch, with robust error handling and reporting.

# -------------------------
# 1. Workflow Triggers
# -------------------------
on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

# -------------------------
# 2. Job Definitions
# -------------------------
jobs:
  test:
    name: Run Pytest Suite
    runs-on: ubuntu-latest
    timeout-minutes: 10  # Prevents long-running or stuck jobs

    steps:
      # ---- Step 1: Checkout Code ----
      - name: Checkout repository
        uses: actions/checkout@v4

      # ---- Step 2: Set up Python ----
      - name: Set up Python 3.10
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      # ---- Step 3: Install Dependencies ----
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r default/requirements.txt

      # ---- Step 4: Run Pytest ----
      - name: Run pytest tests
        id: pytest
        run: |
          pytest tests/ --maxfail=5 --disable-warnings --tb=short

      # ---- Step 5: Upload Pytest Report (Optional) ----
      # Uncomment the following lines to upload test results as an artifact
      # - name: Upload pytest report
      #   uses: actions/upload-artifact@v4
      #   with:
      #     name: pytest-report
      #     path: tests/.pytest_cache

    # ---- Error Handling ----
    # The job will automatically fail if any test fails (pytest nonzero exit code)
    # For troubleshooting, review the 'Run pytest tests' step logs in the Actions UI

# -------------------------
# 3. Documentation & Troubleshooting
# -------------------------
# - This workflow is auto-triggered on push/PR to main.
# - Python 3.10 is used to ensure consistency with project requirements.
# - All tests in the 'tests' directory are executed.
# - Job fails if any test fails (see pytest output in logs).
# - To debug: Click on failed workflow run > 'Run pytest tests' step > review output/errors.
# - For more verbose output, adjust pytest arguments (e.g., remove --tb=short).
# - For large test suites, consider parallel jobs or matrix builds.
#
# -------------------------
# 4. Recommendations for Optimization & Scalability
# -------------------------
# - Add caching for dependencies to speed up builds (see actions/cache).
# - Integrate code coverage tools (e.g., coverage.py + codecov action).
# - Use matrix strategy to test multiple Python versions if needed.
# - Enable notifications (e.g., Slack, email) for failed runs.
# - For larger projects, split linting, testing, and deployment into separate jobs.
#
# -------------------------
# 5. Validation Report
# -------------------------
# - This workflow is validated for the following:
#   * Triggers on push and PR to main branch
#   * Uses Python 3.10
#   * Installs dependencies from default/requirements.txt
#   * Runs all tests in 'tests' directory using pytest
#   * Fails pipeline if any test fails
#   * No source or test files are modified
#   * File is placed at .github/workflows/ci.yml
#
# For questions, see default/README.md or contact repository maintainer.
