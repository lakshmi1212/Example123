# ===========================================================================
# CI Pipeline for Python Project: Automated pytest Execution
# ---------------------------------------------------------------------------
# This workflow runs on push and pull_request events targeting the main branch.
# It sets up Python 3.10, installs dependencies (pytest), and executes all
# tests in the 'tests' directory. The workflow fails if any test fails.
#
# Troubleshooting:
# - If the workflow fails at 'Install dependencies', check requirements.txt and pip logs.
# - If tests fail, review the pytest output in the 'Run tests' step.
# - If you add dependencies, update requirements.txt and commit the change.
#
# Optimization/Scalability Recommendations:
# - Cache pip dependencies for faster builds.
# - Integrate coverage reporting and badge.
# - Add matrix builds for multiple Python versions if needed.
# ===========================================================================

name: CI Pipeline

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  test:
    name: Run Pytest on Python 3.10
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Python 3.10
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      # Documentation: If requirements.txt is missing, pytest is installed directly.
      - name: Install dependencies
        run: |
          if [ -f requirements.txt ]; then
            pip install -r requirements.txt
          else
            pip install pytest
          fi

      - name: Run tests
        run: pytest tests --maxfail=1 --disable-warnings --tb=short

      # The job will fail if any test fails; detailed error output is provided by pytest.
