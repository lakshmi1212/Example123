# =============================================================
# GitHub Actions CI Workflow for Python (pytest)
#
# This workflow runs pytest-based tests on every push and pull
# request targeting the main branch. It ensures code quality,
# reliability, and fast feedback for all contributors.
#
# Key Features:
#  - Triggers on push to main and PRs targeting main
#  - Python 3.10 environment
#  - Installs dependencies from requirements.txt (pytest)
#  - Runs all tests in the tests/ directory
#  - Fails pipeline on any test failure
#  - Provides test summary and error output
#
# Troubleshooting:
#  - Check the 'Install dependencies' and 'Run tests' steps for errors
#  - Ensure requirements.txt includes all dependencies
#  - Review pytest output for failed assertions
#
# Recommendations:
#  - For larger projects, consider using pytest-cov for coverage
#  - Use artifacts to upload test reports if needed
#  - Pin dependency versions for reproducibility
# =============================================================

name: CI Pipeline

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  test:
    runs-on: ubuntu-latest
    name: Run Python unit tests (pytest)
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Python 3.10
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      - name: Run tests with pytest
        run: |
          pytest tests/

      - name: Upload pytest results on failure
        if: failure()
        uses: actions/upload-artifact@v4
        with:
          name: pytest-failure-logs
          path: .

#
# Documentation:
# - This workflow will stop and mark the check as failed if any test fails.
# - All test output is available in the workflow logs for diagnosis.
#
# Validation Report:
# - Triggers: Push to main, PRs to main
# - Python 3.10 runner
# - Installs pytest from requirements.txt
# - Executes all tests in tests/
# - Fails on any test error
# - No modification to source or test files
#
# For further help, see https://docs.github.com/en/actions
