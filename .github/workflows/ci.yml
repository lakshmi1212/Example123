name: CI Pipeline

description: |
  Production-ready GitHub Actions workflow for running pytest-based tests on every push and pull request to main. Automatically installs dependencies, executes all tests in the tests directory, and fails the build on any test failure. Includes error handling, reporting, and documentation for troubleshooting and scalability.

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  test:
    name: Run Pytest Tests
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Python 3.10
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          if [ -f requirements.txt ]; then pip install -r requirements.txt; else pip install pytest; fi

      - name: Run pytest
        run: |
          pytest tests --maxfail=1 --disable-warnings --tb=short

      - name: Upload pytest results (on failure)
        if: failure()
        uses: actions/upload-artifact@v4
        with:
          name: pytest-failure-logs
          path: .

    # Error handling and troubleshooting guidance
    # - If the workflow fails, check the logs for details on failed tests or dependency installation issues.
    # - Ensure all test files are located in the 'tests' directory and import paths are correct.
    # - For more verbose output, modify the 'pytest' command in the workflow.

    # Recommendations for optimization and scalability
    # - Use a test requirements file (requirements-test.txt) for larger projects.
    # - Add test coverage reporting with 'pytest-cov' for code quality insights.
    # - Use matrix builds for multi-version testing (e.g., multiple Python versions).
    # - Integrate status badges and notifications for workflow status visibility.
