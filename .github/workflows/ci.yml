#
# GitHub Actions CI Pipeline for Python project
#
# This workflow automatically runs pytest test cases on every push or pull request to the main branch.
# It ensures code quality by failing the build if any test fails.
#
# Troubleshooting and Optimization guidance are provided at the end of this file.
#
name: CI Pipeline

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  test:
    name: Run Pytest Suite
    runs-on: ubuntu-latest
    defaults:
      run:
        shell: bash
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Python 3.10
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          if [ -f requirements.txt ]; then pip install -r requirements.txt; else pip install pytest; fi

      - name: Run pytest and generate report
        run: |
          pytest tests --maxfail=1 --disable-warnings --tb=short
        continue-on-error: false

      - name: Upload pytest results (if needed)
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: pytest-results
          path: .pytest_cache

#
# Documentation:
#
# - Triggers: This workflow runs on push and pull_request events targeting the main branch.
# - Python: Uses version 3.10 as specified in project metadata.
# - Dependencies: Installs from requirements.txt if present, otherwise installs pytest directly.
# - Test Execution: Runs all tests under the tests/ directory using pytest. The build fails if any test fails.
# - Reporting: Pytest's .pytest_cache is uploaded as an artifact for troubleshooting.
#
# Validation Report:
#   - Workflow file generated at: .github/workflows/ci.yml
#   - Triggers: push and pull_request to main branch
#   - Python 3.10 configured
#   - pytest installed and executed against tests/
#   - Pipeline fails if any test fails
#   - No changes made to source or test files
#
# Troubleshooting Guide:
#   - If the workflow fails at 'Install dependencies', check requirements.txt for syntax or dependency issues.
#   - If pytest fails, review the output logs in the Actions tab and download the pytest-results artifact for cache and debugging info.
#   - Ensure your tests are located in the tests/ directory and named test_*.py.
#
# Recommendations for Optimization and Scalability:
#   - For large projects, consider parallel test execution using pytest-xdist and matrix builds.
#   - Integrate code coverage (e.g., pytest-cov) and reporting to Codecov or Coveralls.
#   - Add linting and static analysis steps (e.g., flake8, mypy).
#   - Use dependency caching for faster builds (actions/cache).
#   - Configure badge in README.md for build status visibility.
