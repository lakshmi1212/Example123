# CI Pipeline for Python Project with pytest
# This workflow runs on push and pull request events targeting the main branch.
# It sets up Python 3.10, installs dependencies, and runs all tests in the 'tests' directory using pytest.
# 
# ---
# TROUBLESHOOTING:
# - If the workflow fails at 'Install dependencies', check requirements.txt and ensure all dependencies are listed.
# - If 'Run tests' fails, inspect the pytest output for failing test cases and stack traces.
# - For environment issues, ensure your code and tests are compatible with Python 3.10.
# 
# RECOMMENDATIONS:
# - For large projects, consider caching dependencies to speed up workflow runs.
# - Use pytest plugins for advanced reporting (e.g., pytest-cov for coverage).
# - Integrate status badges in your README for CI visibility.
# - Review workflow run logs for optimization opportunities.
# ---

name: CI Pipeline

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  test:
    name: Run Pytest on Python 3.10
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Python 3.10
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          if [ -f default/requirements.txt ]; then pip install -r default/requirements.txt; else pip install pytest; fi

      - name: Run tests with pytest
        run: |
          pytest tests/

      - name: Upload pytest results (if any)
        if: always()
        uses: actions/upload-artifact@v3
        with:
          name: pytest-results
          path: .pytest_cache/

      - name: Generate summary report
        if: failure()
        run: |
          echo "::error::Some tests failed. Check the logs above for details."

#
# Documentation:
# - This workflow will automatically run on every push to main and on pull requests targeting main.
# - It installs dependencies from default/requirements.txt (containing pytest), then runs all tests in the 'tests' directory.
# - The workflow will fail if any test fails, ensuring code quality.
# - Test results cache is uploaded as an artifact for further inspection if needed.
#
# For more information, see the README.md in the 'default' directory.
